<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs
   title="breadcrumbs"
   height="50"
   description="Script que genera los breadcrumbs de forma automÃ¡tica"
   />
<UserPref name="VarrootSite" display_name="Root del Site" required="true" />
<Content type="html" view="configuration" preferred_height="480">
 <![CDATA[
 <style>
    input#VarrootSite {
           width: 300px;
          }
		  
  </style>
  <table width="100%" border="0" id="tablaconfig">           
            <tr>       
                <td>
                    Root del Site: <input type="text" id="VarrootSite"  onchange="registra('VarrootSite')"/>                   
                </td>
            </tr>
			
<script type="text/javascript">           
            // Get userprefs
            var prefs = new gadgets.Prefs();           
            function registra(variable)
            {	alert(variable);
			alert(document.getElementById(variable).value);
                prefs.set(variable,document.getElementById(variable).value);
				
            }  
			
            gadgets.window.adjustHeight();
        </script>   
 ]]>
 </Content>
 <Content type="html">
 <![CDATA[
 
	<div id="title-crumbs">valor de title</div>
	
	<style>		
		#title-crumbs {
			font-size:13px;
			color:#3F78B2;
			text-transform: capitalize;
		}
		a.linkBreadCrumb,
		a:visited.linkBreadCrumb {
			fon-weight: normal;
			font-size:13px;
			color:#3F78B2;
			text-decoration:none;
			text-transform: capitalize;
		}
		a:hover.linkBreadCrumb,
		a:active.linkBreadCrumb {
			font-style: normal;
			font-size:13px;
			color:#009EE5;
			fon-weight: normal;
			text-decoration:none;		
			text-transform: capitalize;
		} 
		
	</style>
	
	<script type="text/javascript">
	 var prefs = new gadgets.Prefs();
		gadgets.util.registerOnLoadHandler(showBreadcrumbs);
		
		
		function showBreadcrumbs()
		{
			// Construct the breadcrumb string
		    var auxiliar = prefs.getString("VarrootSite");
			var rootSite = document.getElementById(auxiliar).value; 
		    alert(rootSite);
			var s ="";
			var i,j,k = 0;
			var base = "";
			var barra = "/";
			var parametros = gadgets.util.getUrlParameters()["parent"].split("/");  
			var indexroot = parametros.indexOf(rootSite);
			
			for (i=0;i<parametros.length;i++)
			{				
				if(i<indexroot)
				{
					base = base + parametros[i]+ "/";				
				}
				if (parametros[i] == rootSite) 
				{	
					s = "&nbsp;<a class=\'linkBreadCrumb\' href=\'"+ base + rootSite + barra + "\' target=\'_parent\' title=\' " + parametros[i].replace(/-/g," ") + "  \'>home</a>";
				
					for(j=i+1;j<parametros.length;++j)
					{   
						var aux = parametros[j].replace(/-/g," ");
						if (aux.indexOf("?")>1)
						{
							var auxMov = aux.split("?");
							var litEnlace = auxMov[0]
						}
						else
						{
							var litEnlace = aux;
						}
						s = s + "<a class=\'linkBreadCrumb\' href=\'"+ base  + rootSite + barra  + parametros[j] + barra + "\' target=\'_parent\' title=\'" + litEnlace + "\'> >&nbsp;" + litEnlace + "</a>";
						rootSite = rootSite + "/" + parametros[j];
					}
				}
			}
			document.getElementById("title-crumbs").innerHTML = s;    
		}
	</script>
 ]]>
 
 </Content>
</Module>