<?xml version="1.0" encoding="UTF-8"?>
<Module>
	<ModulePrefs title="Datos del cliente. Ficha cliente. detallleCliente.xml"
		description=""
		author_affiliation="Capgemini">
		<Require feature="idi"/>
		<Require feature="locked-domain" />
	</ModulePrefs>
	
	<UserPref name="_table_query_url" default_value="" display_name="Data source url (Ej:https://docs.google.com/spreadsheet/ccc?key=0AoYEewut2JmZdG5HM2VLTTdwQUlLdmhnMk1DLXBWZl)" required="true" />
	
	<Content type="html">
		<![CDATA[

		<script src="https://www.google.com/jsapi" type="text/javascript"></script>

		<style type="text/css">	
.filaPar {
				background: white; 
				border-bottom: 1px solid #E2E2E2; 
				height: 45px; 
				font-family:  Arial, Helvetica, sans-serif;
				font-size:13px;
			}
			.filaImpar {
				background: #DFE3E5; 
				border-bottom: 1px solid #E2E2E2; 
				height: 45px; 
				font-family: Arial, Helvetica, sans-serif;
				font-size:13px;
			}
			.filaSeleccionada{
				background: white; 
				border-bottom: 1px solid #A22E212; 
				height: 45px; 
				font-family: Arial, Helvetica, sans-serif;
				font-size:13px;
			}
			.filaHover{
				background: #F0EEE2; 
				border-bottom: 1px solid #B2B2B2; 
				height: 45px;
				font-family: Arial, Helvetica, sans-serif;
				font-size:13px;
			}
			#tablediv table,
			#tablediv table tr,
			#tablediv table	tr td {
				font-family: Arial, Helvetica, sans-serif !important;
			}		
			.formateoCelda {
				font-family: Arial, Helvetica, sans-serif !important;
				padding-left: 5px !important;
			}
			.header {
				background-color: #2966B0;	
				color: white; 
				font-size:14px; 
				font-weight: bold;
				text-align: center;
				font-family: Arial, Helvetica, sans-serif;
				height: 35px;
			}
			a.enlaceTabla,
			a:active.enlaceTabla,
			a:visited.enlaceTabla {
				color: #3F78B2;
			}
			a:hover.enlaceTabla {
				color: #009EE5;
			}		
			img.loading {
				margin: 0 0 0 20px;
			}
			h2 {
				color: #0B5394;
				font-family: trebuchet ms,sans-serif;
				font-size: x-large;
				line-height:18px;
				margin-left: 5px;
				width: 99%;
				font-weight: normal;
			}
			h2 div {
				display:inline;
				float:right;
			}
			#imagenCliente {
				display: inline;
				float: left;
				margin-left: 10px;
				text-align: left;
				width: 280px;
			}
			#imagenCliente img {
				margin-right: 40px;
			}
			hr {
				background-color: #CCCCCC;
				border-width: 0;
				height: 1px;
			}
			ul#datosFicha {
				border-collapse: collapse;
				color: #666666;
				font-family: trebuchet ms,sans-serif;
				font-size: 12px;
				font-style: normal;
				font-variant: normal;
				font-weight: normal;
				letter-spacing: normal;
				line-height: 17px;
				text-align: left;
				text-indent: 0;
				text-transform: none;
				white-space: normal;
				word-spacing: 0;
			}
			ul#datosFicha li {
				border-collapse: collapse;
				color: #0b5394;
				font-family: trebuchet ms,sans-serif;
				font-size: 12px;
				font-style: normal;
				font-variant: normal;
				font-weight: normal;
				letter-spacing: normal;
				line-height: 17px;
				text-align: left;
				text-indent: 0;
				text-transform: none;
				white-space: normal;
				word-spacing: 0;
			}
			ul#datosFicha li span {
				font-family: trebuchet ms,sans-serif;
				font-size: small;
				line-height: 17px;
				text-align: justify;
				color: #666666;
			}
		</style>
		<!--
		<div id="tablediv"><img class="loading" width="50" src="https://gsites-labs-capgemini-valencia.googlecode.com/svn/trunk/img/loading.gif"/></div>
		
		<div id="tabledivProducto"><img class="loading" width="50" src="https://gsites-labs-capgemini-valencia.googlecode.com/svn/trunk/img/loading.gif"/></div>
		
		
		<h2>
			Ficha Cliente <span id="nombreCliente"><img class="loading" width="15" src="https://bbvagcs.googlecode.com/svn/trunk/img/loading.gif"/></span>
			<hr>
		</h2>			

		<div id="detalleFicha">
			<div id="imagenCliente"><img class="loading" width="100" src="https://bbvagcs.googlecode.com/svn/trunk/img/loading.gif"/></div>
			<ul id="datosFicha">
				<li>Código Cliente: <span id="idCliente"><img class="loading" width="15" src="https://bbvagcs.googlecode.com/svn/trunk/img/loading.gif"/></span></li>
				<li>Producto: <span id="idProducto"><img class="loading" width="15" src="https://bbvagcs.googlecode.com/svn/trunk/img/loading.gif"/></span></li>
				<li>Servicio: <span id="idServicio"><img class="loading" width="15" src="https://bbvagcs.googlecode.com/svn/trunk/img/loading.gif"/></span></li>
				<li>Formato: <span id="idFormato"><img class="loading" width="15" src="https://bbvagcs.googlecode.com/svn/trunk/img/loading.gif"/></span></li>
				<li>Detalle: <span id="idDetalle"><img class="loading" width="15" src="https://bbvagcs.googlecode.com/svn/trunk/img/loading.gif"/></span></li>
				<li>Países: <span id="idPaises"><img class="loading" width="15" src="https://bbvagcs.googlecode.com/svn/trunk/img/loading.gif"/></span></li>
			</ul>
		</div>-->
		<div style="margin-bottom: 10px; padding: 5px; border: 1px solid gray; background-color: buttonface;">
<span> Configure the query</span>
<form action="">
<table style="font-size: 12px; ">
  <tr>
    <td>Select</td>
    <td><select id='query-1' onchange='setQuery(this.value)'>
      <option value=''>None</option>
      <option value='select A,B'>select A,B</option>
      <option value='select A,B,D'>select A,B,D</option>
      <option value='select D,E,A'>select D,E,A</option>
      <option value='select E,G,B,C'>select E,G,B,C</option>
      <option value='select F,A,B,D'>select F,A,B,D</option>
    </select></td>
    <td>Group by:</td>
    <td><select id='query-2' onchange='setQuery(this.value)'>
      <option value=''>None</option>
      <option value='select B,sum(F) group by B'>select B,sum(F) group
      by B</option>
      <option value='select B,avg(G),sum(E) group by B'>select
      B,avg(G),sum(E) group by A</option>
    </select></td>
    <td>Scalar functions:</td>
    <td> <select id='query-3' onchange='setQuery(this.value)'>
      <option value=''>None</option>
      <option value='select F-E'>select F-E</option>
      <option value='select F*G'>select F*G</option>
      <option value='select (F-E)*G'>select (F-E)*G</option>
    </select></td>
    <td>Filter:</td>
    <td><select id='query-3' onchange='setQuery(this.value)'>
      <option value=''>None</option>
      <option value='where G &lt; 80'>where G &lt; 80</option>
      <option value='where G &lt; 90'>where G &lt; 90</option>
      <option value="where D &lt;&gt; 'Asia'">where D &lt;&gt; 'Asia'</option>
    </select></td>
  </tr>
  <tr>
    <td>Pivot:</td>
    <td><select id='query-3' onchange='setQuery(this.value)'>
      <option value=''>None</option>
      <option value='select avg(F) pivot B'>select avg(F) pivot B</option>
      <option value='select sum(G),max(F) pivot D'>select sum(G),max(F) pivot D</option>
    </select></td>
    <td>Offset / limit: </td>
    <td><select id='query-3' onchange='setQuery(this.value)'>
      <option value=''>None</option>
      <option value='offset 3'>offset 3</option>
      <option value='limit 5'>limit 5</option>
      <option value='limit 4 offset 2'>limit 4 offset 2</option>
    </select></td>
    <td>Label / Format:</td>
    <td><select id='query-3' onchange='setQuery(this.value)'>
      <option value=''>None</option>
      <option value="select A label A 'Manager Name'">select A label A
      'Manager Name'</option>
      <option value="select G format G '00%'">select G format G '00%'</option>
    </select></td>
  </tr>
</table>
</form>
</div>
<table style='width: 100%;'>
  <tr style='font-size: 20px;'>
    <td>Original Table</td>
    <td>Query Table</td>
  </tr>
  <tr>
    <td style="width: 50%; padding: 10px; vertical-align: top;">
    <div id="table"></div>
    </td>
    <td style="width: 50%; padding: 10px; vertical-align: top;">
    <div id="querytable"></div>
    <div style='font-size: 15px; font-weight: bold; padding: 5px;'><input
      type="text" style="width: 100%" id='display-query' /> <br></br>
    <input type="button" value='edit &amp; submit' onclick="setQueryFromUser()" /></div>
    </td>
  </tr>
</table>
</body>
		<script type="text/javascript">
      google.load('visualization', '1', {packages: ['table']});
    

    var isFirstTime = true;
    var options = {'showRowNumber': true};
    var data;
    var queryInput;
        
    // To see the data that this visualization uses, browse to
    // http://spreadsheets.google.com/pub?key=rYQm6lTXPH8dHA6XGhJVFsA
    //var query = new google.visualization.Query('http://spreadsheets.google.com/tq?key=rYQm6lTXPH8dHA6XGhJVFsA&pub=1');
    
	var gadgetHelper = null;	
			var prefs = new _IG_Prefs(); // User preferences			
			var urlTable = prefs.getString("_table_query_url");	
	var query = new google.visualization.Query(urlTable);
	//
    function sendAndDraw() {
      // Send the query with a callback function.
      query.send(handleQueryResponse);
    }
    
    function handleQueryResponse(response) {
      if (response.isError()) {
        alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
        return;
      }
      data = response.getDataTable();
      var table = new google.visualization.Table(document.getElementById('querytable'));
      table.draw(data, {'showRowNumber': true});
      if (isFirstTime) {
      init();
      }
    }
    
    function setQuery(queryString) {
      // Query language examples configured with the UI
      query.setQuery(queryString);
      sendAndDraw();
      queryInput.value = queryString;
    }
    
    

    google.setOnLoadCallback(sendAndDraw);

    function init() {
      isFirstTime = false;
      (new google.visualization.Table(document.getElementById('table'))).draw(data, options);
      queryInput = document.getElementById('display-query');
    }

    function setQueryFromUser() {
      setQuery(queryInput.value);
    }
    console.debug('detalleCliente.xml version 26');
    </script>
	
		
		]]>
	</Content>
</Module>